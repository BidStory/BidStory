<h2>🔲 إنشاء QR Code طويل</h2>
<textarea id="textToEncode" rows="5" placeholder="أدخل نصًا طويلًا هنا (حتى 1000+ حرف)"></textarea><br>
<button onclick="generateQRCode()">✅ إنشاء QR</button><br>
<div id="qr-output"></div>

<hr>

<h2>📷 قراءة QR Code من الكاميرا</h2>
<button onclick="startQRScanner()">📡 ابدأ المسح</button><br>
<video id="video" width="300" height="200" autoplay></video>
<div id="output">👁️ لم يتم قراءة شيء بعد...</div>

<!-- مكتبة ZXing UMD -->
<script src="https://cdn.jsdelivr.net/npm/@zxing/library@0.18.6/umd/index.min.js"></script>

<script>
  function generateQRCode() {
    const text = document.getElementById("textToEncode").value.trim();
    if (!text) return alert("⚠️ أدخل نصًا أولاً!");

    const qrCode = new ZXing.QRCodeWriter();
    const hints = new Map();
    const width = 256;
    const height = 256;

    const bitMatrix = qrCode.encode(text, ZXing.BarcodeFormat.QR_CODE, width, height, hints);

    const canvas = document.createElement("canvas");
    canvas.width = width;
    canvas.height = height;
    const ctx = canvas.getContext("2d");

    ctx.fillStyle = "#000";
    ctx.fillRect(0, 0, width, height);
    ctx.fillStyle = "#fff";

    for (let y = 0; y < height; y++) {
      for (let x = 0; x < width; x++) {
        if (bitMatrix.get(x, y)) {
          ctx.fillRect(x, y, 1, 1);
        }
      }
    }

    const output = document.getElementById("qr-output");
    output.innerHTML = "";
    output.appendChild(canvas);
  }

  async function startQRScanner() {
    const video = document.getElementById("video");
    const output = document.getElementById("output");

    const codeReader = new ZXing.BrowserQRCodeReader();
    output.textContent = "📡 جاري المسح...";

    try {
      const result = await codeReader.decodeOnceFromVideoDevice(undefined, "video");
      output.textContent = "✅ تم القراءة: " + result.text;
      codeReader.reset();
    } catch (err) {
      output.textContent = "❌ فشل في المسح: " + err;
    }
  }
</script>
