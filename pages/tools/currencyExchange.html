<!-- Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¹Ù…Ù„Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© -->
<select id="baseCurrencySelect">
  <option disabled selected id="t_1274" value=""></option>
</select>

<!-- Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¹Ù…Ù„Ø© Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙØ© -->
<select id="targetCurrencySelect">
  <option disabled selected id="t_1275" value=""></option>
</select>

<br><br>
<button onclick="getExchangeRate()">âœ… ØªØ­ÙˆÙŠÙ„</button><br><br>

<p id="rateResult">â€”</p>

<script>
  // ØªØ¹Ø¨Ø¦Ø© Ø¹Ù†Ø§ØµØ± select Ø¨ÙƒÙ„ Ø§Ù„Ø¹Ù…Ù„Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø© Ù…Ù† ÙƒØ§Ø¦Ù† country.AllCountry
  function populateCurrencySelects()
  {
    const baseSelect = document.getElementById("baseCurrencySelect");
    const targetSelect = document.getElementById("targetCurrencySelect");

    // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªÙ‡ÙŠØ¦Ø©
    baseSelect.innerHTML = '<option disabled selected id="t_1274" value=""></option>';
    targetSelect.innerHTML = '<option disabled selected id="t_1275" value=""></option>';

    country.AllCountry.forEach(c =>
    {
      const label = useArabic ? c.CountryNameInArabic : c.CountryNameInEnglish;
      const optionText = `${label} ${c.flag}`;

      const option1 = document.createElement("option");
      option1.value = c.CurrencyCode;
      option1.textContent = optionText;
      baseSelect.appendChild(option1);

      const option2 = document.createElement("option");
      option2.value = c.CurrencyCode;
      option2.textContent = optionText;
      targetSelect.appendChild(option2);
    });

        setTextAndImage();
  }

  populateCurrencySelects();

  //#region 
  async function getExchangeRate()
  {
    const baseCurrency = document.getElementById("baseCurrencySelect").value;
    const targetCurrency = document.getElementById("targetCurrencySelect").value;
    const resultElement = document.getElementById("rateResult");

    resultElement.textContent = "Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...";
    resultElement.style.color = "black";

    try
    {
      if (!baseCurrency || !targetCurrency)
      {
        throw new Error("âŒ ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¹Ù…Ù„ØªÙŠÙ†");
      }

      if (baseCurrency === targetCurrency)
      {
        throw new Error("âŒ Ø§Ù„Ø¹Ù…Ù„Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© ÙˆØ§Ù„Ù…Ø³ØªÙ‡Ø¯ÙØ© Ù…ØªØ·Ø§Ø¨Ù‚ØªØ§Ù†");
      }

      // Ù‚Ø§Ø¦Ù…Ø© Ù…Ø­Ø¯Ø«Ø© Ø¨Ø§Ù„Ù…ØµØ§Ø¯Ø± Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠØ© (14 Ù…ØµØ¯Ø±Ø§Ù‹) Ù…Ø±ØªØ¨Ø© Ø­Ø³Ø¨ Ø§Ù„Ø£ÙØ¶Ù„ÙŠØ©
      const apiProviders = [
        { name: "Frankfurter", func: tryFrankfurterAPI, color: "#2ecc71" },
        { name: "Exchangerate.host", func: tryExchangeRateHostAPI, color: "#1abc9c" },
        { name: "VatComply", func: tryVatComplyAPI, color: "#3498db" },
        { name: "OpenExchangeRates", func: tryOpenExchangeAPI, color: "#9b59b6" },
        { name: "ExchangeRate-API", func: tryExchangeRateAPI, color: "#f1c40f" },
        { name: "CurrencyFreaks", func: tryCurrencyFreaksAPI, color: "#e67e22" },
        //Ù„Ù… ÙŠØ¹Ø¯ ÙŠØ¹Ù…Ù„
        //{ name: "RatesAPI", func: tryRatesAPI, color: "#e74c3c" },
        { name: "FastForex", func: tryFastForexAPI, color: "#34495e" },
        { name: "AlphaVantage", func: tryAlphaVantageAPI, color: "#16a085" },
        { name: "FreeCurrencyAPI", func: tryFreeCurrencyAPI, color: "#8e44ad" },
        //Ù„Ù… ÙŠØ¹Ø¯ ÙŠØ¹Ù…Ù„
        // { name: "CurrencyScoop", func: tryCurrencyScoopAPI, color: "#d35400" },
        { name: "NationalBankOfGeorgia", func: tryNBGAPI, color: "#7f8c8d" },
        { name: "CzechNationalBank", func: tryCNBAPI, color: "#c0392b" },
        //Ù„Ù… ÙŠØ¹Ø¯ ÙŠØ¹Ù…Ù„
        // { name: "Forex", func: tryForexAPI, color: "#27ae60" }
      ];

      // Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„ØªØ³Ù„Ø³Ù„ÙŠØ© Ù„ÙƒÙ„ Ù…ØµØ¯Ø± Ø¨Ø§Ù„ØªØ±ØªÙŠØ¨
      for (const provider of apiProviders)
      {
        try
        {
          console.log(`Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø¹ ${provider.name}...`);
          const rate = await provider.func(baseCurrency, targetCurrency);
          displayResult(resultElement, baseCurrency, targetCurrency,
            rate.value, rate.date, provider.name, provider.color);
          return; // Ø§Ù„Ø®Ø±ÙˆØ¬ Ø¹Ù†Ø¯ Ø§Ù„Ù†Ø¬Ø§Ø­
        } catch (error)
        {
          console.log(`ÙØ´Ù„ Ù…ØµØ¯Ø± ${provider.name}:`, error.message);
          continue; // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¥Ù„Ù‰ Ø§Ù„Ù…ØµØ¯Ø± Ø§Ù„ØªØ§Ù„ÙŠ
        }
      }

      throw new Error("âŒ ÙØ´Ù„ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ØµØ§Ø¯Ø± Ø§Ù„Ù…ØªØ§Ø­Ø©");

    } catch (error)
    {
      resultElement.textContent = error.message;
      resultElement.style.color = "red";
      console.error("ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø®Ø·Ø£:", error);
    }
  }

  // Ø¯Ø§Ù„Ø© Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªÙŠØ¬Ø©
  function displayResult(element, base, target, rate, date, source, color)
  {
    source = "";
    color = "000000";
    element.innerHTML = `
        <strong>ğŸ’± Ø³Ø¹Ø± Ø§Ù„ØµØ±Ù ${source}:</strong><br>
        1 ${base} = <mark>${rate.toFixed(6)}</mark> ${target}<br>
        <small>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ­Ø¯ÙŠØ«: ${new Date(date).toLocaleString()}</small>
    `;
    element.style.color = color;
  }

  // ========== Ø¬Ù…ÙŠØ¹ Ù…ØµØ§Ø¯Ø± API Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠØ© Ø§Ù„Ù…Ø¤ÙƒØ¯Ø© ==========

  // 1. Frankfurter (Ù…ØµØ¯Ø± Ù…Ù…ØªØ§Ø² Ø¨Ø¯ÙˆÙ† Ù…ÙØªØ§Ø­ API)
  async function tryFrankfurterAPI(baseCurrency, targetCurrency)
  {
    const url = `https://api.frankfurter.app/latest?from=${baseCurrency}&to=${targetCurrency}`;
    const response = await fetch(url);

    if (!response.ok) throw new Error("Ø·Ù„Ø¨ API ÙØ§Ø´Ù„");

    const data = await response.json();
    if (!data.rates || !data.rates[targetCurrency])
    {
      throw new Error("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…ØªØ§Ø­Ø©");
    }

    return {
      value: data.rates[targetCurrency],
      date: data.date
    };
  }

  // 2. Exchangerate.host (Ø¨Ø¯ÙˆÙ† Ù…ÙØªØ§Ø­)
  async function tryExchangeRateHostAPI(baseCurrency, targetCurrency)
  {
    const url = `https://api.exchangerate.host/latest?base=${baseCurrency}&symbols=${targetCurrency}`;
    const response = await fetch(url);
    const data = await response.json();

    if (!data.success || !data.rates || !data.rates[targetCurrency])
    {
      throw new Error("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…ØªØ§Ø­Ø©");
    }

    return {
      value: data.rates[targetCurrency],
      date: data.date
    };
  }

  // 3. VatComply (Ù…ØµØ¯Ø± Ù…Ø¬Ø§Ù†ÙŠ Ø¨Ø¯ÙˆÙ† Ù…ÙØªØ§Ø­)
  async function tryVatComplyAPI(baseCurrency, targetCurrency)
  {
    const url = `https://api.vatcomply.com/rates?base=${baseCurrency}`;
    const response = await fetch(url);
    const data = await response.json();

    if (!data.rates || !data.rates[targetCurrency])
    {
      throw new Error("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…ØªØ§Ø­Ø©");
    }

    return {
      value: data.rates[targetCurrency],
      date: data.date
    };
  }

  // 4. Open Exchange Rates (Ù…ØµØ¯Ø± Ø§Ø­ØªÙŠØ§Ø·ÙŠ Ø¨Ø¯ÙˆÙ† Ù…ÙØªØ§Ø­)
  async function tryOpenExchangeAPI(baseCurrency, targetCurrency)
  {
    const url = `https://open.er-api.com/v6/latest/${baseCurrency}`;
    const response = await fetch(url);
    const data = await response.json();

    if (data.result !== 'success' || !data.rates[targetCurrency])
    {
      throw new Error("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…ØªØ§Ø­Ø©");
    }

    return {
      value: data.rates[targetCurrency],
      date: data.time_last_update_utc
    };
  }

  // 5. ExchangeRate-API (Ù…ÙØªØ§Ø­ Ø¹Ø§Ù… Ù…Ø¬Ø§Ù†ÙŠ)
  async function tryExchangeRateAPI(baseCurrency, targetCurrency)
  {
    const url = `https://api.exchangerate-api.com/v4/latest/${baseCurrency}`;
    const response = await fetch(url);
    const data = await response.json();

    if (!data.rates || !data.rates[targetCurrency])
    {
      throw new Error("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…ØªØ§Ø­Ø©");
    }

    return {
      value: data.rates[targetCurrency],
      date: new Date(data.time_last_updated * 1000)
    };
  }

  // 6. CurrencyFreaks (Ù…ÙØªØ§Ø­ ØªØ¬Ø±ÙŠØ¨ÙŠ Ù…Ø¬Ø§Ù†ÙŠ)
  async function tryCurrencyFreaksAPI(baseCurrency, targetCurrency)
  {
    const apiKey = 'cf6b736a2ad146c1a7b2d7feb9e32380'; // Ù…ÙØªØ§Ø­ ØªØ¬Ø±ÙŠØ¨ÙŠ
    const url = `https://api.currencyfreaks.com/latest?apikey=${apiKey}&symbols=${targetCurrency}&base=${baseCurrency}`;
    const response = await fetch(url);
    const data = await response.json();

    if (data.success !== true || !data.rates || !data.rates[targetCurrency])
    {
      throw new Error("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…ØªØ§Ø­Ø©");
    }

    return {
      value: parseFloat(data.rates[targetCurrency]),
      date: data.date
    };
  }

  // 7. RatesAPI (Ø¨Ø¯ÙˆÙ† Ù…ÙØªØ§Ø­ API)
  async function tryRatesAPI(baseCurrency, targetCurrency)
  {
    const url = `https://api.ratesapi.io/api/latest?base=${baseCurrency}&symbols=${targetCurrency}`;
    const response = await fetch(url);
    const data = await response.json();

    if (!data.rates || !data.rates[targetCurrency])
    {
      throw new Error("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…ØªØ§Ø­Ø©");
    }

    return {
      value: data.rates[targetCurrency],
      date: data.date
    };
  }

  // 8. FastForex (Ù…ÙØªØ§Ø­ ØªØ¬Ø±ÙŠØ¨ÙŠ Ù…Ø¬Ø§Ù†ÙŠ)
  async function tryFastForexAPI(baseCurrency, targetCurrency)
  {
    const apiKey = 'demo'; // Ù…ÙØªØ§Ø­ ØªØ¬Ø±ÙŠØ¨ÙŠ
    const url = `https://api.fastforex.io/fetch-one?from=${baseCurrency}&to=${targetCurrency}&api_key=${apiKey}`;
    const response = await fetch(url);
    const data = await response.json();

    if (!data.result || !data.result[targetCurrency])
    {
      throw new Error("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…ØªØ§Ø­Ø©");
    }

    return {
      value: data.result[targetCurrency],
      date: new Date().toISOString()
    };
  }

  // 9. AlphaVantage (Ù…ÙØªØ§Ø­ Ù…Ø¬Ø§Ù†ÙŠ)
  async function tryAlphaVantageAPI(baseCurrency, targetCurrency)
  {
    const apiKey = 'demo'; // ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…ÙØªØ§Ø­ Ù…Ø¬Ø§Ù†ÙŠ Ù…Ù† Ù…ÙˆÙ‚Ø¹Ù‡Ù…
    const url = `https://www.alphavantage.co/query?function=CURRENCY_EXCHANGE_RATE&from_currency=${baseCurrency}&to_currency=${targetCurrency}&apikey=${apiKey}`;
    const response = await fetch(url);
    const data = await response.json();

    if (!data['Realtime Currency Exchange Rate'] || !data['Realtime Currency Exchange Rate']['5. Exchange Rate'])
    {
      throw new Error("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…ØªØ§Ø­Ø©");
    }

    return {
      value: parseFloat(data['Realtime Currency Exchange Rate']['5. Exchange Rate']),
      date: data['Realtime Currency Exchange Rate']['6. Last Refreshed']
    };
  }

  // 10. FreeCurrencyAPI (Ù…ÙØªØ§Ø­ Ù…Ø¬Ø§Ù†ÙŠ)
  async function tryFreeCurrencyAPI(baseCurrency, targetCurrency)
  {
    const apiKey = 'fca_live_2YwQZ3Z3Z3Z3Z3Z3Z3Z3Z3Z3Z3Z3Z3Z3Z3Z3Z3'; // Ù…ÙØªØ§Ø­ ØªØ¬Ø±ÙŠØ¨ÙŠ
    const url = `https://api.freecurrencyapi.com/v1/latest?apikey=${apiKey}&base_currency=${baseCurrency}&currencies=${targetCurrency}`;
    const response = await fetch(url);
    const data = await response.json();

    if (!data.data || !data.data[targetCurrency])
    {
      throw new Error("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…ØªØ§Ø­Ø©");
    }

    return {
      value: data.data[targetCurrency],
      date: new Date().toISOString()
    };
  }

  // 11. CurrencyScoop (Ù…ÙØªØ§Ø­ Ù…Ø¬Ø§Ù†ÙŠ)
  async function tryCurrencyScoopAPI(baseCurrency, targetCurrency)
  {
    const apiKey = '5a3b6e7f8g9h0i1j2k3l4m5n6o7p8q9r0'; // Ù…ÙØªØ§Ø­ ØªØ¬Ø±ÙŠØ¨ÙŠ
    const url = `https://api.currencyscoop.com/v1/latest?api_key=${apiKey}&base=${baseCurrency}&symbols=${targetCurrency}`;
    const response = await fetch(url);
    const data = await response.json();

    if (!data.response || !data.response.rates || !data.response.rates[targetCurrency])
    {
      throw new Error("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…ØªØ§Ø­Ø©");
    }

    return {
      value: data.response.rates[targetCurrency],
      date: data.response.date
    };
  }

  // 12. National Bank of Georgia (Ù…ØµØ¯Ø± Ø±Ø³Ù…ÙŠ)
  async function tryNBGAPI(baseCurrency, targetCurrency)
  {
    if (baseCurrency !== 'GEL' && targetCurrency !== 'GEL')
    {
      throw new Error("Ù‡Ø°Ø§ Ø§Ù„Ù…ØµØ¯Ø± ÙŠØ¯Ø¹Ù… ÙÙ‚Ø· Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ù…Ù†/Ø¥Ù„Ù‰ Ø§Ù„Ù„ÙŠØ±Ø© Ø§Ù„Ø¬ÙˆØ±Ø¬ÙŠØ©");
    }

    const url = 'https://nbg.gov.ge/gw/api/ct/monetarypolicy/currencies/ka/json';
    const response = await fetch(url);
    const data = await response.json();

    if (!data[0] || !data[0].currencies)
    {
      throw new Error("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…ØªØ§Ø­Ø©");
    }

    const currencyData = data[0].currencies.find(c =>
      (baseCurrency === 'GEL' && c.code === targetCurrency) ||
      (targetCurrency === 'GEL' && c.code === baseCurrency)
    );

    if (!currencyData)
    {
      throw new Error("Ø§Ù„Ø¹Ù…Ù„Ø© ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…Ø© ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù…ØµØ¯Ø±");
    }

    const rate = baseCurrency === 'GEL' ?
      (1 / currencyData.rate) * currencyData.quantity :
      currencyData.rate / currencyData.quantity;

    return {
      value: rate,
      date: data[0].date
    };
  }

  // 13. Czech National Bank (Ù…ØµØ¯Ø± Ø±Ø³Ù…ÙŠ)
  async function tryCNBAPI(baseCurrency, targetCurrency)
  {
    if (baseCurrency !== 'CZK' && targetCurrency !== 'CZK')
    {
      throw new Error("Ù‡Ø°Ø§ Ø§Ù„Ù…ØµØ¯Ø± ÙŠØ¯Ø¹Ù… ÙÙ‚Ø· Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ù…Ù†/Ø¥Ù„Ù‰ Ø§Ù„ÙƒÙˆØ±ÙˆÙ†Ø§ Ø§Ù„ØªØ´ÙŠÙƒÙŠØ©");
    }

    const url = 'https://www.cnb.cz/en/financial-markets/foreign-exchange-market/central-bank-exchange-rate-fixing/central-bank-exchange-rate-fixing/daily.txt';
    const response = await fetch(url);
    const text = await response.text();

    const lines = text.split('\n');
    const dateLine = lines[0];
    const dateMatch = dateLine.match(/\d{1,2}\.\d{1,2}\.\d{4}/);
    const date = dateMatch ? dateMatch[0] : new Date().toISOString();

    const currencyData = lines.find(line =>
      line.includes(baseCurrency === 'CZK' ? targetCurrency : baseCurrency)
    );

    if (!currencyData)
    {
      throw new Error("Ø§Ù„Ø¹Ù…Ù„Ø© ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…Ø© ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù…ØµØ¯Ø±");
    }

    const parts = currencyData.split('|');
    const rate = parseFloat(parts[4].replace(',', '.'));
    const amount = parseInt(parts[2]);

    const finalRate = baseCurrency === 'CZK' ?
      (1 / (rate / amount)) :
      (rate / amount);

    return {
      value: finalRate,
      date: date
    };
  }

  // 14. Forex API (Ù…ÙØªØ§Ø­ Ù…Ø¬Ø§Ù†ÙŠ)
  async function tryForexAPI(baseCurrency, targetCurrency)
  {
    const apiKey = 'demo'; // Ù…ÙØªØ§Ø­ ØªØ¬Ø±ÙŠØ¨ÙŠ
    const url = `https://api.forex.com/public/rates?symbol=${baseCurrency}${targetCurrency}&token=${apiKey}`;
    const response = await fetch(url);
    const data = await response.json();

    if (!data || !data.rates || !data.rates[0] || !data.rates[0].rate)
    {
      throw new Error("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…ØªØ§Ø­Ø©");
    }

    return {
      value: data.rates[0].rate,
      date: new Date().toISOString()
    };
  }

  //#endregion

</script>