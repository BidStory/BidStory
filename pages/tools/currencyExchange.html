<!-- Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¹Ù…Ù„Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© -->
<select id="baseCurrencySelect">
  <option value="">â€” Ø§Ø®ØªØ± Ø§Ù„Ø¹Ù…Ù„Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© â€”</option>
</select>

<!-- Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¹Ù…Ù„Ø© Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙØ© -->
<select id="targetCurrencySelect">
  <option value="">â€” Ø§Ø®ØªØ± Ø§Ù„Ø¹Ù…Ù„Ø© Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙØ© â€”</option>
</select>

<br><br>
<button onclick="getExchangeRate()">âœ… ØªØ­ÙˆÙŠÙ„</button><br><br>

<p id="rateResult">â€”</p>

<script>
  // ØªØ¹Ø¨Ø¦Ø© Ø¹Ù†Ø§ØµØ± select Ø¨ÙƒÙ„ Ø§Ù„Ø¹Ù…Ù„Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø© Ù…Ù† ÙƒØ§Ø¦Ù† country.AllCountry
  function populateCurrencySelects() {
    const baseSelect = document.getElementById("baseCurrencySelect");
    const targetSelect = document.getElementById("targetCurrencySelect");

    // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªÙ‡ÙŠØ¦Ø©
    baseSelect.innerHTML = '<option value="">â€” Ø§Ø®ØªØ± Ø§Ù„Ø¹Ù…Ù„Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© â€”</option>';
    targetSelect.innerHTML = '<option value="">â€” Ø§Ø®ØªØ± Ø§Ù„Ø¹Ù…Ù„Ø© Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙØ© â€”</option>';

    country.AllCountry.forEach(c => {
      const label = useArabic ? c.CountryNameInArabic : c.CountryNameInEnglish;
      const optionText = `${label} (${c.CurrencyCode})`;

      const option1 = document.createElement("option");
      option1.value = c.CurrencyCode;
      option1.textContent = optionText;
      baseSelect.appendChild(option1);

      const option2 = document.createElement("option");
      option2.value = c.CurrencyCode;
      option2.textContent = optionText;
      targetSelect.appendChild(option2);
    });
  }

  populateCurrencySelects();

  async function getExchangeRate() {
    const baseCurrency = document.getElementById("baseCurrencySelect").value;
    const targetCurrency = document.getElementById("targetCurrencySelect").value;
    const resultElement = document.getElementById("rateResult");

    resultElement.textContent = "Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...";
    resultElement.style.color = "black";

    try {
      if (!baseCurrency || !targetCurrency) {
        throw new Error("âŒ ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¹Ù…Ù„ØªÙŠÙ†");
      }

      if (baseCurrency === targetCurrency) {
        throw new Error("âŒ Ø§Ù„Ø¹Ù…Ù„Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© ÙˆØ§Ù„Ù…Ø³ØªÙ‡Ø¯ÙØ© Ù…ØªØ·Ø§Ø¨Ù‚ØªØ§Ù†");
      }

      // API Ù…Ù† Frankfurter
      const url = `https://api.frankfurter.app/latest?from=${baseCurrency}&to=${targetCurrency}`;
      const response = await fetch(url);

      if (!response.ok) {
        return await tryFallbackAPI(baseCurrency, targetCurrency);
      }

      const data = await response.json();

      if (!data.rates || !data.rates[targetCurrency]) {
        throw new Error(`âŒ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø³Ø¹Ø± ØµØ±Ù ${baseCurrency}/${targetCurrency}`);
      }

      const rate = data.rates[targetCurrency];
      resultElement.innerHTML = `
        <strong>ğŸ’± Ø³Ø¹Ø± Ø§Ù„ØµØ±Ù:</strong><br>
        1 ${baseCurrency} = <mark>${rate.toFixed(6)}</mark> ${targetCurrency}<br>
        <small>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ­Ø¯ÙŠØ«: ${new Date(data.date).toLocaleString()}</small>
      `;
      resultElement.style.color = "green";
    } catch (error) {
      resultElement.textContent = error.message;
      resultElement.style.color = "red";
      console.error("ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø®Ø·Ø£:", error);
    }
  }

  // Ù…ØµØ¯Ø± Ø§Ø­ØªÙŠØ§Ø·ÙŠ
  async function tryFallbackAPI(baseCurrency, targetCurrency) {
    const resultElement = document.getElementById("rateResult");
    try {
      const url = `https://open.er-api.com/v6/latest/${baseCurrency}`;
      const response = await fetch(url);
      const data = await response.json();

      if (data.result === 'success' && data.rates[targetCurrency]) {
        const rate = data.rates[targetCurrency];
        resultElement.innerHTML = `
          <strong>ğŸ’± Ø³Ø¹Ø± Ø§Ù„ØµØ±Ù (Ù…ØµØ¯Ø± Ø§Ø­ØªÙŠØ§Ø·ÙŠ):</strong><br>
          1 ${baseCurrency} = <mark>${rate.toFixed(6)}</mark> ${targetCurrency}<br>
          <small>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ­Ø¯ÙŠØ«: ${new Date(data.time_last_update_utc).toLocaleString()}</small>
        `;
        resultElement.style.color = "blue";
      } else {
        throw new Error("âŒ Ù„Ø§ ØªØªÙˆÙØ± Ø¨ÙŠØ§Ù†Ø§Øª Ø³Ø¹Ø± Ø§Ù„ØµØ±Ù");
      }
    } catch {
      throw new Error("âŒ ÙØ´Ù„ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ØµØ§Ø¯Ø± Ø§Ù„Ù…ØªØ§Ø­Ø©");
    }
  }
</script>
