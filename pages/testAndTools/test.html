<script>

function calculateSuppliesPercentprice(values, percents, prices) {
    if (values.length !== percents.length || values.length !== prices.length) {
        throw new Error("❌ جميع المصفوفات يجب أن تكون بطول متساوٍ.");
    }

    let totalSum = 0;
    let approvedValueSum = 0;
    let weightedPriceSum = 0;
    let approvedWeights = 0;

    for (let i = 0; i < values.length; i++) {
        const value = values[i];
        const percent = percents[i];
        const price = prices[i];

        const approvedValue = value * (percent / 100);
        totalSum += approvedValue * price;
        approvedValueSum += approvedValue;

        // نستخدم approvedValue بدلاً من value لحساب السعر المرجح
        weightedPriceSum += price * approvedValue;
        approvedWeights += approvedValue;
    }

    if (approvedValueSum === 0) {
        throw new Error("⚠️ مجموع الكميات المعتمدة (بعد ضربها بالنسب) يساوي صفر، لا يمكن إتمام الحسابات.");
    }

    const foundPrice = weightedPriceSum / approvedWeights;
    const foundPercent = 100; // لأننا نستخدم السعر المرجح بناءً على الكميات المعتمدة مباشرة
    const checkTotal = foundPrice * approvedValueSum;

    return {
        totalSum: totalSum.toFixed(2),
        valueSum: approvedValueSum.toFixed(2),
        foundPercent: foundPercent.toFixed(2),
        foundPrice: foundPrice.toFixed(3),
        checkTotal: checkTotal.toFixed(2)
    };
}

// 🧪 التجربة
const result = calculateSuppliesPercentprice(
  [2, ''],    // الكميات
  [100, null],    // النسب
  [37, null]      // الأسعار
);

// ✅ عرض النتائج
console.log("📦 إجمالي القيمة المعتمدة:", result.totalSum);
console.log("🧮 مجموع الكميات المعتمدة:", result.valueSum);
console.log("📈 النسبة الموحدة:", result.foundPercent + "%");
console.log("💰 السعر الموحد:", result.foundPrice);
console.log("🔁 تحقق من الإجمالي:", result.checkTotal);
</script>
