<script>
function isNumeric(value)
{
  if (value === null || value === undefined) return false;

  const str = String(value).trim();
  if (str === '') return false;

  // @ts-ignore
  return !isNaN(str) && !isNaN(parseFloat(str));
}

function calculateSuppliesPercentprice(values, percents, prices) {
    if (values.length !== percents.length || values.length !== prices.length) {
        throw new Error("❌ جميع المصفوفات يجب أن تكون بطول متساوٍ.");
    }

    const cleanValues = [];
    const cleanPercents = [];
    const cleanPrices = [];

    for (let i = 0; i < values.length; i++) {
        const value = values[i];
        const percent = percents[i];
        const price = prices[i];

        if (isNumeric(value) && isNumeric(percent) && isNumeric(price)) {
            cleanValues.push(Number(value));
            cleanPercents.push(Number(percent));
            cleanPrices.push(Number(price));
        }
    }

    values = cleanValues;
    percents = cleanPercents;
    prices = cleanPrices;

    let totalSum = 0;
    let approvedValueSum = 0;
    let weightedPriceSum = 0;
    let approvedWeights = 0;
    let originalValueSum = 0;

    for (let i = 0; i < values.length; i++) {
        const value = values[i];
        const percent = percents[i];
        const price = prices[i];

        const approvedValue = value * (percent / 100);

        totalSum += approvedValue * price;
        approvedValueSum += approvedValue;
        weightedPriceSum += price * approvedValue;
        approvedWeights += approvedValue;

        // ✅ نأخذ القيمة المطلقة حتى لا يؤثر الخصم على النسبة الكلية
        originalValueSum += Math.abs(value);
    }

    if (approvedValueSum === 0) {
        console.log("⚠️ مجموع الكميات المعتمدة (بعد ضربها بالنسب) يساوي صفر، لا يمكن إتمام الحسابات.");
    }

    const foundPrice = weightedPriceSum / approvedWeights;

    const foundPercent = (originalValueSum === 0) ? 0 : (approvedValueSum / originalValueSum) * 100;

    const checkTotal = foundPrice * approvedValueSum;

    return {
        totalSum: Number(totalSum),
        valueSum: Number(approvedValueSum),
        foundPercent: Number(foundPercent),
        foundPrice: Number(foundPrice),
        checkTotal: Number(checkTotal)
    };
}

const result = calculateSuppliesPercentprice(
    [1, -1],     // الكميات
    [100, 50],        // النسب المعتمدة
    [20, 10]         // الأسعار
);

console.log(result);


</script>