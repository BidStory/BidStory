<script>
function isNumeric(value)
{
  if (value === null || value === undefined) return false;

  const str = String(value).trim();
  if (str === '') return false;

  // @ts-ignore
  return !isNaN(str) && !isNaN(parseFloat(str));
}

/**
 * دالة لحساب القيمة الكلية والنسبة الكلية من مصفوفتين
 * @param {Array} values مصفوفة القيم
 * @param {Array} percentages مصفوفة النسب (0-100)
 * @param {number} referenceTotalValue (اختياري) قيمة مرجعية لإعادة احتساب النسبة
 * @returns {object} كائن يحتوي على القيمة الكلية والنسبة الكلية
 */
function calculateTotalValueAndPercent(values, percentages, referenceTotalValue = 0) {
    try {
        let sumUsedValues = 0;
        let weightedSum = 0;

        for (let i = 0; i < values.length; i++) {
            const val = Number(values[i]);
            const pct = Number(percentages[i]) / 100;

            if (isNaN(val) || isNaN(pct)) continue;

            sumUsedValues += val;
            weightedSum += val * pct;
        }

        let overallPercent = sumUsedValues !== 0
            ? (weightedSum / sumUsedValues) * 100
            : 0;

        if (referenceTotalValue !== 0) {
            const finalValue = sumUsedValues * (overallPercent / 100);
            overallPercent = (finalValue / referenceTotalValue) * 100;
            sumUsedValues = referenceTotalValue;
        }

        return {
            totalValue: Number(sumUsedValues.toFixed(2)),
            overallPercent: Number(overallPercent.toFixed(2))
        };
    } catch (error) {
        console.log('❌ خطأ في calculateTotalValueAndPercent:', error);
        return {
            totalValue: 0,
            overallPercent: 0
        };
    }
}

const values = [100, 200, -50];
const percentages = [50, 25, 10];

console.log(calculateTotalValueAndPercent(values, percentages,100));




</script>