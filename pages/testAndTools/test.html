<!DOCTYPE html>
<html lang="ar">

<head>
    <meta charset="UTF-8">
    <title>ØªØµØ¯ÙŠØ± Ø¬Ø¯ÙˆÙ„ HTML Ø¥Ù„Ù‰ Excel</title>
    <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
    <style>
        table {
            border-collapse: collapse;
            width: 100%;
            direction: rtl;
        }

        th,
        td {
            border: 1px solid #888;
            padding: 8px;
            text-align: center;
        }

        th {
            background-color: #f0f0f0;
        }

        tfoot td {
            font-weight: bold;
            background-color: #e8f4ea;
        }
    </style>
</head>

<body>

    <h3>ğŸ“Š Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†Ø§Ù‚ØµØ§Øª</h3>
    <table id="dataTable">
        <thead>
            <tr>
                <th>Ø±Ù‚Ù… Ø§Ù„Ù…Ù†Ø§Ù‚ØµØ©</th>
                <th>Ø§Ù„Ø¬Ù‡Ø©</th>
                <th>Ù‚ÙŠÙ…Ø© Ø§Ù„ØªÙ‚Ø¯ÙŠØ± (Ø¬.Ù…)</th>
                <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥ØºÙ„Ø§Ù‚</th>
            </tr>
        </thead>
        <tbody id="tableBody"></tbody>
        <tfoot>
            <tr>
                <td colspan="2">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</td>
                <td id="totalCell">â€”</td>
                <td></td>
            </tr>
        </tfoot>
    </table>

    <br>
    <button onclick="exportToExcel()">ğŸ“¥ ØªØµØ¯ÙŠØ± Ø¥Ù„Ù‰ Excel</button>

    <script>
        // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†Ø§Ù‚ØµØ§Øª (Ø¨Ø§Ù„Ø£Ø±Ù‚Ø§Ù… ÙÙ‚Ø· Ù„ØªØ³Ù‡ÙŠÙ„ Ø§Ù„Ø¬Ù…Ø¹)
        const tenders = [
            { id: "2025-001", agency: "ÙˆØ²Ø§Ø±Ø© Ø§Ù„Ù†Ù‚Ù„", value: 500000, deadline: "2025-07-01" },
            { id: "2025-002", agency: "Ø´Ø±ÙƒØ© Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¡", value: 1200000, deadline: "2025-07-10" },
            { id: "2025-003", agency: "Ø§Ù„Ù‡ÙŠØ¦Ø© Ø§Ù„Ø¹Ø§Ù…Ø© Ù„Ù„Ù…ÙŠØ§Ù‡", value: 850000, deadline: "2025-07-15" }
        ];

        // Ù…Ù„Ø¡ Ø§Ù„Ø¬Ø¯ÙˆÙ„
        const tableBody = document.getElementById("tableBody");
        let totalValue = 0;
        tenders.forEach(tender =>
        {
            const row = document.createElement("tr");
            row.innerHTML = `
      <td>${tender.id}</td>
      <td>${tender.agency}</td>
      <td>${tender.value.toLocaleString()} Ø¬.Ù…</td>
      <td>${tender.deadline}</td>
    `;
            totalValue += tender.value;
            tableBody.appendChild(row);
        });

        // Ø¥Ø¯Ø±Ø§Ø¬ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ ÙÙŠ Ø®Ù„ÙŠØ© Ø§Ù„ØªØ°ÙŠÙŠÙ„
        document.getElementById("totalCell").textContent = totalValue.toLocaleString() + " Ø¬.Ù…";

        // Ø§Ù„ØªØµØ¯ÙŠØ± Ø¥Ù„Ù‰ Excel
        function exportToExcel()
        {
            const table = document.getElementById("dataTable");

            // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø¥Ù„Ù‰ ÙˆØ±Ù‚Ø© Ø¹Ù…Ù„
            const worksheet = XLSX.utils.table_to_sheet(table);

            // Ø¥Ø¹Ø¯Ø§Ø¯ Ù…ØµÙÙˆÙØ© Ù„Ø¯Ù…Ø¬ Ø§Ù„Ø®Ù„Ø§ÙŠØ§
            const merges = [];

            // Ù…Ø³Ø­ Ø§Ù„Ø¬Ø¯ÙˆÙ„ ÙŠØ¯ÙˆÙŠÙ‹Ø§ Ù„Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ colspan Ùˆ rowspan
            const rows = table.rows;
            for (let rowIndex = 0; rowIndex < rows.length; rowIndex++)
            {
                const cells = rows[rowIndex].cells;
                let colOffset = 0;

                for (let cellIndex = 0; cellIndex < cells.length; cellIndex++)
                {
                    const cell = cells[cellIndex];
                    const colspan = parseInt(cell.getAttribute("colspan") || "1");
                    const rowspan = parseInt(cell.getAttribute("rowspan") || "1");

                    // Ø¥ÙŠØ¬Ø§Ø¯ Ø§Ù„Ø¹Ù…ÙˆØ¯ Ø§Ù„ÙØ¹Ù„ÙŠ ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„
                    let col = 0;
                    for (let i = 0; i < cellIndex + colOffset; i++)
                    {
                        const prevCell = cells[i];
                        if (prevCell)
                        {
                            const prevColspan = parseInt(prevCell.getAttribute("colspan") || "1");
                            col += prevColspan;
                        }
                    }

                    if (colspan > 1 || rowspan > 1)
                    {
                        merges.push({
                            s: { r: rowIndex, c: col },
                            e: { r: rowIndex + rowspan - 1, c: col + colspan - 1 }
                        });
                    }
                    
                }
            }

            // Ø±Ø¨Ø· Ø§Ù„Ø¯Ù…Ø¬ Ø¨Ø§Ù„ÙˆØ±Ù‚Ø©
            worksheet["!merges"] = merges;

            // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…ØµÙ†Ù ÙˆØªØµØ¯ÙŠØ±Ù‡
            const workbook = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(workbook, worksheet, "Ø§Ù„Ù…Ù†Ø§Ù‚ØµØ§Øª");
            XLSX.writeFile(workbook, "Ù…Ù†Ø§Ù‚ØµØ§Øª.xlsx");
            
        }

    </script>

</body>

</html>