<!--- Ø²Ø± Ø¥Ø¶Ø§ÙØ© Ø¯ÙØ¹Ø© Ø¬Ø¯ÙŠØ¯Ø© --->
<button onclick="addBill()">
    <img id="i_addBill" alt="addBill" style="width: 20px; height: 20px; vertical-align: middle; margin-left: 5px" />
    <br />
    <span id="t_1268"></span>
    <!-- Ø³ÙŠØªÙ… ØªØ¹Ø¨Ø¦ØªÙ‡ Ø¨Ù†Øµ Ù…Ø¹Ø±Ù‘Ø¨ -->
</button>
<button onclick="deletBill()">
    <img id="i_delet" alt="addBill" style="width: 20px; height: 20px; vertical-align: middle; margin-left: 5px" />
    <br />
    <span id="t_214"></span>
    <!-- Ø³ÙŠØªÙ… ØªØ¹Ø¨Ø¦ØªÙ‡ Ø¨Ù†Øµ Ù…Ø¹Ø±Ù‘Ø¨ -->
</button>
<!--- Ø­Ø§ÙˆÙŠØ© Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¯ÙØ¹Ø§Øª --->
<br /><br />
<div id="buttonsContainer"></div>

<br /><br />

<style>
    #billContaner::-webkit-scrollbar {
        height: 5px;
    }

    #billContaner::-webkit-scrollbar-track {
        background: #f0f0f0;
        border-radius: 5px;
    }

    #billContaner::-webkit-scrollbar-thumb {
        background: linear-gradient(90deg, #3d3e3f, #3d3e3f);
        border-radius: 5px;
    }

    #billContaner::-webkit-scrollbar-thumb:hover {
        background: linear-gradient(90deg, #040404, #040404);
    }
</style>
<!--- Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø¬Ø¯ÙˆÙ„ --->
<div id="billContaner" style="max-width:100%;overflow-x: scroll;"></div>

<!-- Ù‚Ø§Ù„Ø¨ Ø§Ù„ØµÙÙˆÙ Ø§Ù„Ù…Ø®ÙÙŠØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø© Ù„Ù†Ø³Ø® ØµÙÙˆÙ Ø§Ù„Ø¬Ø¯ÙˆÙ„ -->
<div id="PandBillRaw" style="display: none;">
    <table>
        <thead class="hide-text">
            <tr>
                <th id="t_37"></th>
                <!-- Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø£ÙˆÙ„ -->
                <th id="t_413"></th>
                <th id="t_112"></th>
                <th id="t_113"></th>
                <th id="t_114"></th>
                <th id="t_115"></th>
                <th id="t_116"></th>
                <th id="t_907"></th>
                <!--sum1-->
                <th id="t_93"></th>
                <!--state-->
                <th id="t_293"></th>
                <!--type-->
                <th id="t_861"></th>
                <!----percentage-->
                <th id="t_281"></th>
                <!---price-->
                <th id="t_39"></th>
                <!---notes-->
                <th id="t_104"></th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <!-- number  -->
                <td>
                    <input id="numbering" readonly type="text" placeholder="" style="
              outline: none;
              border: none;
              background-color: transparent;
              color: black;
            " />
                </td>
                <!-- bill text  -->
                <td>
                    <input id="PandBillText" type="text" placeholder=""
                        style="border: none; background-color: transparent; color: black" />
                </td>
                <!-- number of  -->
                <td>
                    <input id="PandBillNo" type="number" placeholder=""
                        style="border: none; background-color: transparent; color: black" />
                </td>
                <!-- length -->
                <td>
                    <input id="PandBillLength" type="number" placeholder=""
                        style="border: none; background-color: transparent; color: black" />
                </td>
                <!-- width -->
                <td>
                    <input id="PandBillWidth" type="number" placeholder=""
                        style="border: none; background-color: transparent; color: black" />
                </td>
                <!-- hight -->
                <td>
                    <input id="PandBillHight" type="number" placeholder=""
                        style="border: none; background-color: transparent; color: black" />
                </td>
                <!-- kg -->
                <td>
                    <input id="PandBillKg" type="number" placeholder=""
                        style="border: none; background-color: transparent; color: black" />
                </td>
                <!-- kind of sum  -->
                <td>
                    <select id="PandBillKindSum">
                        <option id="t_401" value="0"></option>
                        <option id="t_118" value="1"></option>
                    </select>
                </td>
                <!-- sum  -->
                <td>
                    <input id="PandBillSum" readonly type="number" placeholder="" style="
              outline: none;
              border: none;
              background-color: transparent;
              color: black;
            " />
                </td>
                <!-- state  -->
                <td>
                    <input id="PandBillStat" type="text" placeholder=""
                        style="border: none; background-color: transparent; color: black" />
                </td>
                <!-- kind of work   -->
                <td>
                    <select id="PandBillKindWork">
                        <option id="t_226" value="0"></option>
                        <option id="t_227" value="1"></option>
                    </select>
                </td>
                <!-- percentage  -->
                <td>
                    <input id="PandBillPercent" type="number" min="0" max="100" placeholder="" style="
              outline: none;
              border: none;
              background-color: transparent;
              color: black;
            " />
                </td>
                <!-- price  -->
                <td>
                    <input id="PandBillPrice" type="number" placeholder="" style="
              outline: none;
              border: none;
              background-color: transparent;
              color: black;
            " />
                </td>

                <!-- note  -->
                <td>
                    <input id="PandBillNote" type="text" placeholder="" style="
              outline: none;
              border: none;
              background-color: transparent;
              color: black;
            " />
                </td>
            </tr>
        </tbody>
    </table>
</div>

<div id="results">
    <br><br>
    <table>
        <!---Ø§Ø­Ù…Ø§Ù„ÙŠ Ø§Ù„Ø§Ø¶Ø§ÙØ© Ù„Ù„Ø§Ø¹Ù…Ø§Ù„-->
        <!--Total Works Addition-->
        <tr>
            <td>
                <label id="t_925"></label>

            </td>
            <td>
                <input id="TotalWorksAddition" type="text" readonly placeholder="" style="
              outline: none;
              border: none;
              background-color: transparent;
              color: black;
            " />
            </td>
        </tr>
        <!---Ø§Ø­Ù…Ø§Ù„ÙŠ Ø§Ù„Ø®ØµÙ… Ù„Ù„Ø§Ø¹Ù…Ø§Ù„-->
        <!--Total Works Discount--->
        <tr>
            <td>
                <label id="t_926"></label>

            </td>
            <td>
                <input id="TotalWorksDiscount" type="text" readonly placeholder="" style="
              outline: none;
              border: none;
              background-color: transparent;
              color: black;
            " />
            </td>
        </tr>
        <!---Ø§Ø­Ù…Ø§Ù„ÙŠ Ù„Ù„Ø§Ø¹Ù…Ø§Ù„-->
        <!--Total Works--->
        <tr>
            <td>
                <label id="t_929"></label>

            </td>
            <td>
                <input id="TotalWorks" type="text" readonly placeholder="" style="
              outline: none;
              border: none;
              background-color: transparent;
              color: black;
            " />
            </td>
        </tr>
        <!---Ø§Ø­Ù…Ø§Ù„ÙŠ Ø§Ù„Ø§Ø¶Ø§ÙØ© Ù„Ù„ØªØ´ÙˆÙŠÙ†Ø§Øª-->
        <!---Total Supplies Addition-->
        <tr>
            <td>
                <label id="t_927"></label>

            </td>
            <td>
                <input id="TotalSuppliesAddition" type="text" readonly placeholder="" style="
              outline: none;
              border: none;
              background-color: transparent;
              color: black;
            " />
            </td>
        </tr>
        <!---Ø§Ø­Ù…Ø§Ù„ÙŠ Ø§Ù„Ø®ØµÙ… Ù„Ù„ØªØ´ÙˆÙŠÙ†Ø§Øª-->
        <!--Total Supplies Discount--->
        <tr>
            <td>
                <label id="t_928"></label>

            </td>
            <td>
                <input id="TotalSuppliesDiscount" type="text" readonly placeholder="" style="
              outline: none;
              border: none;
              background-color: transparent;
              color: black;
            " />
            </td>
        </tr>
        <!---Ø§Ø­Ù…Ø§Ù„ÙŠ Ù„Ù„ØªØ´ÙˆÙŠÙ†Ø§Øª-->
        <!---Total Supplies-->
        <tr>
            <td>
                <label id="t_930"></label>

            </td>
            <td>
                <input id="TotalSupplies" type="text" readonly placeholder="" style="
              outline: none;
              border: none;
              background-color: transparent;
              color: black;
            " />
            </td>
        </tr>
    </table>
    <br><br>
    <table>
        <thead>
            <tr style="text-align: center; vertical-align: middle;">
                <!--Ø§Ù„Ø­Ø§Ù„Ù‡-->
                <th id="t_293"></th>
                <!--Ø§Ù„Ù†Ø³Ø¨-->
                <th id="t_922"></th>
                <!--Ø§Ù„Ø³Ø¹Ø±-->
                <th id="t_39"></th>
                <!--Ø§Ù„Ø§Ø¬Ù…Ø§Ù„ÙŠ-->
                <th id="t_40"></th>
            </tr>
        </thead>
        <!--Ø§Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ù†ÙØ°Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©-->
        <!--Previous Works--->
        <tr style="text-align: center; vertical-align: middle;">
            <td>
                <label id="t_321"></label>
            </td>
            <td>
                <input id="PreviousWorksValue" type="text" readonly placeholder="" style="
              outline: none;
              border: none;
              background-color: transparent;
              color: black;
              max-width: 50px;
              min-width:  50px;
            " />
                <input id="PreviousWorksPercent" type="text" readonly placeholder="" style="
              outline: none;
              border: none;
              background-color: transparent;
              color: black;
                 max-width: 50px;
              min-width:  50px;
            " />
            </td>
            <td>
                <label id="priceWork"></label>
            </td>
            <td>
                <input id="PreviousWorksTotalCost" type="text" readonly placeholder="" style="
              outline: none;
              border: none;
              background-color: transparent;
              color: black;
                 max-width: 50px;
              min-width:  50px;
            " />
            </td>
        </tr>
        <!--Ø§Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ù†ÙØ°Ø© Ø§Ù„Ø­Ø§Ù„ÙŠÙ‡-->
        <!--Current Works--->
        <tr style="text-align: center; vertical-align: middle;">
            <td>
                <label id="t_320"></label>
            </td>
            <td>
                <input id="CurrentWorksValue" type="text" readonly placeholder="" style="
              outline: none;
              border: none;
              background-color: transparent;
              color: black;
              max-width: 50px;
              min-width:  50px;
            " />
                <input id="CurrentWorksPercent" type="text" readonly placeholder="" style="
              outline: none;
              border: none;
              background-color: transparent;
              color: black;
                 max-width: 50px;
              min-width:  50px;
            " />
            </td>
            <td>
                <label id="priceWork"></label>
            </td>
            <td>
                <input id="CurrentWorksTotalCost" type="text" readonly placeholder="" style="
              outline: none;
              border: none;
              background-color: transparent;
              color: black;
                 max-width: 50px;
              min-width:  50px;
            " />
            </td>
        </tr>
        <!--Ø§Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ù†ÙØ°Ø©-->
        <!--Total Executed Works--->
        <tr style="text-align: center; vertical-align: middle;">
            <td>
                <label id="t_323"></label>
            </td>
            <td>
                <input id="TotalExecutedWorks" type="text" readonly placeholder="" style="
              outline: none;
              border: none;
              background-color: transparent;
              color: black;
            " />

            </td>
            <td>
                <label id="priceWork"></label>
            </td>
            <td>

            </td>
        </tr>
        <!--Ø§Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªØ´ÙˆÙŠÙ†Ø§Øª Ø§Ù„Ù…Ù†ÙØ°Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©-->
        <!---Previous Supplies-->
        <tr style="text-align: center; vertical-align: middle;">
            <td>
                <label id="t_920"></label>
            </td>
            <td>
                <input id="PreviousSupplies" type="text" readonly placeholder="" style="
              outline: none;
              border: none;
              background-color: transparent;
              color: black;
            " />

            </td>
            <td>

            </td>
            <td>

            </td>
        </tr>
        <!--Ø§Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªØ´ÙˆÙŠÙ†Ø§Øª Ø§Ù„Ù…Ù†ÙØ°Ø© Ø§Ù„Ø­Ø§Ù„ÙŠÙ‡-->
        <!--Current Supplies--->
        <tr style="text-align: center; vertical-align: middle;">
            <td>
                <label id="t_919"></label>
            </td>
            <td>
                <input id="CurrentSuppliesValue" type="text" readonly placeholder="" style="
              outline: none;
              border: none;
              background-color: transparent;
              color: black;
              max-width: 50px;
              min-width:  50px;
            " />
                <input id="CurrentSuppliesPercent" type="text" readonly placeholder="" style="
              outline: none;
              border: none;
              background-color: transparent;
              color: black;
                 max-width: 50px;
              min-width:  50px;
            " />
            </td>
            <td>

            </td>
            <td>
                <input id="CurrentSuppliesTotalCost" type="text" readonly placeholder="" style="
              outline: none;
              border: none;
              background-color: transparent;
              color: black;
                 max-width: 50px;
              min-width:  50px;
            " />
            </td>
        </tr>
        <!--Ø§Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªØ´ÙˆÙŠÙ†Ø§Øª Ø§Ù„Ù…Ù†ÙØ°Ø©-->
        <!---Total Executed Supplies-->
        <tr style="text-align: center; vertical-align: middle;">
            <td>
                <label id="t_921"></label>
            </td>
            <td>
                <input id="TotalExecutedSupplies" type="text" readonly placeholder="" style="
              outline: none;
              border: none;
              background-color: transparent;
              color: black;
            " />

            </td>
            <td>

            </td>
            <td>

            </td>
        </tr>
    </table>
</div>

<script>
    // ğŸŸ¡ ØªØ¹Ø±ÙŠÙ Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø© - ØªÙ… Ù†Ù‚Ù„Ù‡Ø§ Ø¥Ù„Ù‰ Ù…Ù„Ù Ø§Ù„Ø£Ø¯ÙˆØ§Øª

    // âœ… ÙˆØ¸ÙŠÙØ© Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¯ÙØ¹Ø§Øª
    function clearAllButtons()
    {
        document.getElementById("buttonsContainer").innerHTML = ""; // ØªÙØ±ÙŠØº Ø§Ù„Ø­Ø§ÙˆÙŠØ©
        buttonShowIndexSet.clear(); // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ù…Ø¤Ø´Ø±Ø§Øª
    }

    // âœ… Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± "Ø¥Ø¶Ø§ÙØ© Ø­ØµØ±"
    async function addBill()
    {
        try
        {
            await initPandBillPage();
            lastBill += 1; // ØªÙ‡ÙŠØ¦Ø© ØµÙØ­Ø© Ø§Ù„Ø­ØµØ±
            await addButton(lastBill); // Ø¥Ø¶Ø§ÙØ© Ø²Ø± Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ø¯ÙØ¹Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©
        } catch (error)
        {
            console.error("âŒ Ø®Ø·Ø£ ÙÙŠ addBill:", error);
        }
    }

    async function deletBill()
    {
        try
        {
            await deleteDatabase("bill_" + lastBill + "_" + selectedPandId);
            clearAllButtons();
            await initPandBillPage();
            document.getElementById("billContaner").innerHTML = ""; // ØªÙØ±ÙŠØº Ø§Ù„Ø­Ø§ÙˆÙŠØ©
        } catch (error)
        {
            console.error("âŒ Ø®Ø·Ø£ ÙÙŠ addBill:", error);
        }
    }
    // âœ… ØªØ­Ù…ÙŠÙ„ Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© ÙˆØ¥Ø¸Ù‡Ø§Ø± Ø£Ø²Ø±Ø§Ø±Ù‡Ø§
    async function initPandBillPage()
    {
        try
        {
            lastBill = 0;
            let i = 1;
            while (i <= 100)
            {
                // Ø­Ø¯ Ø£Ù‚ØµÙ‰ Ù„ØªØ¬Ù†Ø¨ Ø§Ù„Ù„ÙˆØ¨ Ø§Ù„Ù„Ø§Ù…ØªÙ†Ø§Ù‡ÙŠ
                const dbName = "bill_" + i + "_" + selectedPandId; // Ø§Ø³Ù… Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                const exists = await checkDatabaseExists(dbName); // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯Ù‡Ø§
                if (exists)
                {
                    await addButton(i); // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø²Ø±
                    lastBill = i; // ØªØ­Ø¯ÙŠØ« Ø¢Ø®Ø± Ø±Ù‚Ù… Ø¯ÙØ¹Ø©
                    i++;
                } else
                {
                    break; // Ø§Ù„ØªÙˆÙ‚Ù Ø¥Ø°Ø§ Ù„Ù… ØªÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ø©
                }
            }


        } catch (error)
        {
            console.error("âŒ Ø®Ø·Ø£ ÙÙŠ initPandBillPage:", error);
        }
    }

    // âœ… Ø¥Ù†Ø´Ø§Ø¡ Ø²Ø± Ø¬Ø¯ÙŠØ¯ ÙŠÙ…Ø«Ù„ Ø¯ÙØ¹Ø© Ù…Ø¹ÙŠÙ†Ø©
    async function addButton(billIndex)
    {
        try
        {

            if (buttonShowIndexSet.has(billIndex))
            {
                return; // Ù„Ø§ ØªÙƒØ±Ø§Ø± Ù„Ù„Ø£Ø²Ø±Ø§Ø±
            } else
            {
                buttonShowIndexSet.add(billIndex); // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø¤Ø´Ø±
            }

            const button = document.createElement("button");
            button.id = "BillB_" + billIndex;
            button.onclick = async function ()
            {
                await addPandBillDatabase(billIndex); // Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ·ØŒ ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯ÙØ¹Ø©
            };
            button.style.margin = "5px"; // ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø²Ø±

            const img = document.createElement("img"); // ØµÙˆØ±Ø© Ø¯Ø§Ø®Ù„ Ø§Ù„Ø²Ø±
            img.alt = "Bill";
            img.id = "i_bill";
            img.style.width = "20px";
            img.style.height = "20px";
            img.style.verticalAlign = "middle";
            img.style.marginLeft = "5px";

            button.appendChild(img);
            button.appendChild(document.createElement("br"));

            const span = document.createElement("span"); // Ù†Øµ Ù…Ø¹Ø±Ù Ø§Ù„Ø²Ø±
            span.id = "t_1065_" + billIndex;
            button.appendChild(span);

            document.getElementById("buttonsContainer").appendChild(button); // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø²Ø± Ù„Ù„ÙˆØ§Ø¬Ù‡Ø©

            await setTextAndImage(); // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ±Ø¬Ù…Ø© ÙˆØ§Ù„ØµÙˆØ±

            const spanNum = document.createElement("span"); // Ø±Ù‚Ù… Ø§Ù„Ø¯ÙØ¹Ø©
            spanNum.innerText = " " + billIndex;
            button.appendChild(spanNum);

        } catch (error)
        {
            console.error("âŒ Ø®Ø·Ø£ ÙÙŠ addButton:", error);
        }
    }
    let stopAddPandBillDatabase = false;

    /*
     âœ… Ø¥Ù†Ø´Ø§Ø¡ Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ¬Ø¯ÙˆÙ„ Ù„Ø¯ÙØ¹Ø© Ù…Ø¹ÙŠÙ†Ø©
    ÙŠØªÙ… Ø§Ù„ØªÙ†ÙÙŠØ° Ø¹Ù† Ø§Ù„Ø¶ØºØ· Ø¹Ù„ÙŠ Ø§Ø­Ø¯ÙŠ Ø§Ù„Ø§Ø²Ø±Ø± Ø§Ù„Ø®Ø§ØµÙ‡ Ø¨Ø¯ÙØ¹Ù‡ Ù…Ø¹ÙŠÙ†Ù‡
    */
    async function addPandBillDatabase(dataBaseIndex)
    {
        try
        {
            dataBaseIdForPandBillPrevious = null;
            if (stopAddPandBillDatabase == true) { return; }
            stopAddPandBillDatabase = true;
            isTableWatcherEnabled = false;
            dataBaseIdForPandBill = "bill_" + dataBaseIndex + "_" + selectedPandId; // Ø§Ø³Ù… Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª

            // Ù…Ø­Ø§ÙˆÙ„Ø© Ø­Ø°Ù Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø³Ø§Ø¨Ù‚ (Ø¥Ù† ÙˆÙØ¬Ø¯)
            try
            {
                await PandBillTable.destroyTable(); // Ø­Ø°Ù Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø­Ø§Ù„ÙŠ
            } catch (error)
            {
                // ØªØ¬Ø§Ù‡Ù„ Ø§Ù„Ø®Ø·Ø£ Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù‡Ù†Ø§Ùƒ Ø¬Ø¯ÙˆÙ„ Ù…ÙˆØ¬ÙˆØ¯ Ù…Ø³Ø¨Ù‚Ø§Ù‹
            }

            if (Number(dataBaseIndex) > 1)
            {
                dataBaseIdForPandBillPrevious = "bill_" + (Number(dataBaseIndex) - 1) + "_" + selectedPandId; // Ø§Ø³Ù… Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            }
            dbNoUp_PandBill = await new noUpgrade(dataBaseIdForPandBill);
            if (Number(dataBaseIndex) > 1)
            {
                dbNoUp_PandBillPrevious = await new noUpgrade(dataBaseIdForPandBillPrevious);
            }
            if (await dbNoUp_PandBill.isTableExist("resultsTable") == false)
            {
                let dbUp_PandBill = await new upgrade(dataBaseIdForPandBill);
                await dbUp_PandBill.createKeyTable("resultsTable");
                dbNoUp_PandBill = await new noUpgrade(dataBaseIdForPandBill);
                if (Number(dataBaseIndex) > 1)
                {
                    dbNoUp_PandBillPrevious = await new noUpgrade(dataBaseIdForPandBillPrevious);
                }
            }


            // Ø¥Ù†Ø´Ø§Ø¡ ÙƒØ§Ø¦Ù† Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ø¬Ø¯ÙˆÙ„ Ù…Ø¹ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª
            PandBillTable = new setTableParameter(
                "billContaner", // Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø¬Ø¯ÙˆÙ„
                dataBaseIdForPandBill, // Ø§Ø³Ù… Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                "PandBillRaw", // Ù‚Ø§Ù„Ø¨ Ø§Ù„ØµÙÙˆÙ
                "", // ØµÙ Ø¨Ø¯ÙŠÙ„ (ØºÙŠØ± Ù…Ø³ØªØ®Ø¯Ù… Ø­Ø§Ù„ÙŠØ§Ù‹)
                true, // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø¹Ù†ÙˆØ§Ù†
                false, // Ø¹Ø¯Ù… Ø¥Ø¶Ø§ÙØ© ØµÙ Ø¨Ø§Ù„Ù†Ù‚Ø±
                true, // Ø¨Ø¯Ø¡ Ø¨ØµÙ Ø¬Ø¯ÙŠØ¯
                true // ØªØ±Ù‚ÙŠÙ… Ø§Ù„ØµÙÙˆÙ
            );

            await initialValues();

        } catch (error)
        {
            console.error("âŒ Ø®Ø·Ø£ ÙÙŠ addPandBillDatabase:", error);
        } finally
        {
            stopAddPandBillDatabase = false;
            isTableWatcherEnabled = true;
        }
    }

    function hasNumericValue(array)
    {
        return array.some(isNumeric);
    }


    let sumList = [
        "PandBillNo",
        "PandBillLength",
        "PandBillWidth",
        "PandBillHight",
        "PandBillKg"
    ];
    let isCalSumBillSectionRunning = false;
    async function calSumBillSection(dataName, tableId)
    {
        try
        {

            if (isCalSumBillSectionRunning)
            {
                return;
            }

            isCalSumBillSectionRunning = true;
            isTableWatcherEnabled = false;
            let dbNoUpgrade_bill = await new noUpgrade(dataName);

            if (isValidIdFormat(tableId))
            {
                let value = [];
                let valueCheck = [];
                let key = null;
                for (let i = 0; i < sumList.length; i++)
                {
                    key = sumList[i];
                    const valueÙ€Ù€ = await dbNoUpgrade_bill.keyGet(tableId, key);
                    valueCheck.push(valueÙ€Ù€);
                }
                let product = 1;
                if (!hasNumericValue(valueCheck))
                {
                    product = 0;

                } else
                {

                    for (let i = 0; i < sumList.length; i++)
                    {
                        let val = valueCheck[i];
                        if (val == null || val === "")
                        {
                            val = 1;
                        }
                        value[i] = val;
                    }

                    for (let i = 0; i < value.length; i++)
                    {
                        product *= Number(value[i]);
                    }

                    if (await dbNoUpgrade_bill.keyGet(tableId, 'PandBillKindSum') == '1')
                    {
                        product *= -1;
                    }

                }
                //Ù„ØªØ­Ø¯ÙŠØ¯ Ø­Ø§Ù„Ù‡ Ø¹Ù†ØµØ± Ø§Ù„Ø³Ø¹Ø± Ø§Ù† ÙƒØ§Ù† Ù‚Ø§Ø¨Ù„ Ù„Ù„Ø§Ø¯Ø®Ø§Ù„ Ø§Ù… Ù„Ø§
                if (await dbNoUpgrade_bill.keyGet(tableId, 'PandBillKindWork') == '0')
                {
                    await isPriceEdit(tableId, 0);
                } else
                {
                    await isPriceEdit(tableId, 1);
                }
                await dbNoUpgrade_bill.keySet(tableId, "PandBillSum", product);
                const raw_ = document.getElementById(tableId + "_");
                const tot_ = raw_.querySelector("#PandBillSum");
                tot_.value = (product).toFixed(DecimalPoint);
                await calSumBill0(dbNoUpgrade_bill);

            }

            isTableWatcherEnabled = true;
        } catch (error)
        {
            console.error("Error calculating calSumBillSection:", error);
        } finally
        {
            isCalSumBillSectionRunning = false;
            isTableWatcherEnabled = true;

        }
    }

    let isCalScalSumBill0Running = false;
    async function calSumBill0(dbNoUpgrade_bill)
    {
        try
        {

            if (isCalScalSumBill0Running)
            {
                return;
            }
            isCalScalSumBill0Running = true;

            let allRows = await dbNoUpgrade_bill.getAllDataFromTable("rows");
            if (!Array.isArray(allRows))
            {
                return;
            }

            //#region Ø¬Ù„Ø¨ Ø§Ù„ØªØ¬Ù…ÙŠØ¹Ø§Øª Ø·Ø¨Ù‚Ø§ Ù„Ù„Ø§Ù†ÙˆØ§Ø¹


            let sumCurrentWorksValue = [];
            let sumCurrentWorksPercent = [];
            let sumTotalWorksAddition = [];
            let sumTotalWorksDiscount = [];

            let sumCurrentSuppliesValue = [];
            let sumCurrentSuppliesPercent = [];
            let sumTotalSuppliesAddition = [];
            let sumTotalSuppliesDiscount = [];


            for (const rawId of allRows)
            {
                //Ø§Ø°Ø§ ÙƒØ§Ù† Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù…Ù„ ØªÙ†ÙÙŠØ°ÙŠ
                if (await dbNoUpgrade_bill.keyGet(rawId.key, "PandBillKindWork") == "0")
                {
                    //Ø§Ø°Ø§ ÙƒØ§Ù† Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù…Ù„ Ø¬Ø¯ÙŠØ¯
                    if (await dbNoUpgrade_bill.keyGet(rawId.key, "PandBillStat") == getLang(685))
                    {
                        sumCurrentWorksValue.push(await dbNoUpgrade_bill.keyGet(rawId.key, "PandBillSum"));
                        sumCurrentWorksPercent.push(await dbNoUpgrade_bill.keyGet(rawId.key, "PandBillPercent"));
                        //Ø§Ø°Ø§ ÙƒØ§Ù† Ù†ÙˆØ¹ Ø§Ù„ØªØ¬Ù…ÙŠØ¹ Ø§Ø¶Ø§ÙÙ‡
                        if (await dbNoUpgrade_bill.keyGet(rawId.key, "PandBillKindSum") == "0")
                        {
                            sumTotalWorksAddition.push(await dbNoUpgrade_bill.keyGet(rawId.key, "PandBillSum"));
                        }
                        else
                        {
                            sumTotalWorksDiscount.push(await dbNoUpgrade_bill.keyGet(rawId.key, "PandBillSum"));
                        }
                    }
                    //Ø§Ø°Ø§ ÙƒØ§Ù† Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù…Ù„ Ø³Ø§Ø¨Ù‚
                    else
                    {

                    }

                }

                //Ø§Ø°Ø§ ÙƒØ§Ù† Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù…Ù„ ØªØ´ÙˆÙŠÙ†Ø§Øª
                else
                {
                    //Ø§Ø°Ø§ ÙƒØ§Ù† Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù…Ù„ Ø¬Ø¯ÙŠØ¯
                    if (await dbNoUpgrade_bill.keyGet(rawId.key, "PandBillStat") == getLang(685))
                    {
                        sumCurrentSuppliesValue.push(await dbNoUpgrade_bill.keyGet(rawId.key, "PandBillSum"));
                        sumCurrentSuppliesPercent.push(await dbNoUpgrade_bill.keyGet(rawId.key, "PandBillPercent"));
                        //Ø§Ø°Ø§ ÙƒØ§Ù† Ù†ÙˆØ¹ Ø§Ù„ØªØ¬Ù…ÙŠØ¹ Ø§Ø¶Ø§ÙÙ‡
                        if (await dbNoUpgrade_bill.keyGet(rawId.key, "PandBillKindSum") == "0")
                        {
                            sumTotalSuppliesAddition.push(await dbNoUpgrade_bill.keyGet(rawId.key, "PandBillSum"));
                        }
                        else
                        {
                            sumTotalSuppliesDiscount.push(await dbNoUpgrade_bill.keyGet(rawId.key, "PandBillSum"));
                        }
                    }
                }


            }
            //#endregion

            //Ø¬Ù„Ø¨ Ø§Ù„Ù‚ÙŠÙ…Ù‡ Ø§Ù„ÙƒÙ„ÙŠÙ‡ ÙˆØ§Ù„Ù†Ø³Ø¨Ù‡ Ø§Ù„ÙƒÙ„ÙŠÙ‡
            const resultWorks = calculateTotalValuPercent(sumCurrentWorksValue, sumCurrentWorksPercent);
            const resultSuplies = calculateTotalValuPercent(sumCurrentSuppliesValue, sumCurrentSuppliesPercent);

            //Ø¬Ù„Ø¨ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„ØªÙŠ Ø³ÙˆÙ ÙŠØ­ÙØ¸ Ø¨Ù‡Ø§ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
            const CurrentWorksValue = document.getElementById('CurrentWorksValue');
            const CurrentWorksPercent = document.getElementById('CurrentWorksPercent');
            const CurrentWorksTotalCost = document.getElementById('CurrentWorksTotalCost');
            const TotalWorks = document.getElementById('TotalWorks');
            const TotalWorksAddition = document.getElementById('TotalWorksAddition');
            const TotalWorksDiscount = document.getElementById('TotalWorksDiscount');

            const CurrentSuppliesValue = document.getElementById('CurrentSuppliesValue');
            const CurrentSuppliesPercent = document.getElementById('CurrentSuppliesPercent');
            const CurrentSuppliesTotalCost = document.getElementById('CurrentSuppliesTotalCost');
            const TotalSupplies = document.getElementById('TotalSupplies');
            const TotalSuppliesAddition = document.getElementById("TotalSuppliesAddition");
            const TotalSuppliesDiscount = document.getElementById('TotalSuppliesDiscount');

            //ÙˆØ¶Ø¹ Ø§Ù„Ù‚ÙŠÙ… ÙÙŠ Ø§Ù„Ø¹Ù†Ø§ØµØ±
            TotalWorks.value = resultWorks.totalValue;
            CurrentWorksValue.value = resultWorks.totalValue;
            CurrentWorksPercent.value = (resultWorks.overallPercent).toFixed(DecimalPoint);
            CurrentWorksTotalCost.value = ((resultWorks.overallPercent / 100) * resultWorks.totalValue * Number(pandPrice)).toFixed(DecimalPoint);
            TotalWorksAddition.value = sumTotalWorksAddition.reduce((acc, val) => acc + val, 0);
            TotalWorksDiscount.value = sumTotalWorksDiscount.reduce((acc, val) => acc + val, 0);

            TotalSupplies.value = resultSuplies.totalValue;
            CurrentSuppliesValue.value = resultSuplies.totalValue;
            CurrentSuppliesPercent.value = (resultSuplies.overallPercent).toFixed(DecimalPoint);
            CurrentSuppliesTotalCost.value = ((resultSuplies.overallPercent / 100) * resultSuplies.totalValue * Number(pandPrice)).toFixed(DecimalPoint);
            TotalSuppliesAddition.value = sumTotalSuppliesAddition.reduce((acc, val) => acc + val, 0);
            TotalSuppliesDiscount.value = sumTotalSuppliesDiscount.reduce((acc, val) => acc + val, 0);

            //Ø¥Ø·Ù„Ø§Ù‚ Ø­Ø¯Ø« Ø§Ù„ØªØºÙŠÙŠØ± ÙŠØ¯ÙˆÙŠÙ‹Ø§ Ù„ÙƒÙŠ ÙŠØªÙ… Ø§Ù„Ø­ÙØ¸
            const inputEvent = new Event('input', { bubbles: true });
            //Ø§Ø·Ù„Ø§Ù‚
            CurrentWorksValue.dispatchEvent(inputEvent);
            CurrentWorksPercent.dispatchEvent(inputEvent);
            CurrentWorksTotalCost.dispatchEvent(inputEvent);
            TotalWorks.dispatchEvent(inputEvent);
            TotalWorksAddition.dispatchEvent(inputEvent);
            TotalWorksDiscount.dispatchEvent(inputEvent);

            TotalSupplies.dispatchEvent(inputEvent);
            CurrentSuppliesValue.dispatchEvent(inputEvent);
            CurrentSuppliesPercent.dispatchEvent(inputEvent);
            CurrentSuppliesTotalCost.dispatchEvent(inputEvent);
            TotalSuppliesAddition.dispatchEvent(inputEvent);
            TotalSuppliesDiscount.dispatchEvent(inputEvent);
        } catch (error)
        {
            console.error("Error calculating calSumBill0: ", error);
        } finally
        {
            isCalScalSumBill0Running = false;


        }
    }

    function calculateTotalValuPercent(value, percent)
    {
        let totalW = 0;
        let totalValue = 0;

        for (let i = 0; i < value.length; i++)
        {
            const val = Number(value[i]);
            const pct = Number(percent[i]);

            totalW += val * pct;
            totalValue += val;
        }

        const overallPercent = totalValue !== 0 ? totalW / totalValue : 0;

        return {
            totalValue,
            overallPercent
        };
    }

    //Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠÙ‡ ÙˆØ¬Ù„Ø¨ Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ù…Ø®Ø²Ù†Ù‡ 
    async function initialValues()
    {
        try
        {
            // #region ğŸ›‘ ØªØ¹Ø·ÙŠÙ„ Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ù…Ø¤Ù‚ØªØ§Ù‹
            isTableWatcherEnabled = false;
            // #endregion

            // #region ğŸ”¤ ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
            const statPrevText = getLang(292);
            const maxAttempts = 20;
            let allRows;
            let attempt = 0;
            // #endregion

            // #region ğŸ” Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø¬Ø¯ÙˆÙ„ (Ø¨Ø­Ø¯ Ø£Ù‚ØµÙ‰ 20 Ù…Ø­Ø§ÙˆÙ„Ø©)
            while (attempt < maxAttempts)
            {
                allRows = await dbNoUp_PandBill.getAllDataFromTable("rows");
                if (Array.isArray(allRows)) break;
                await delay(100);
                attempt++;
            }

            if (!Array.isArray(allRows))
            {
                isTableWatcherEnabled = true;
                return;
            }
            // #endregion

            // #region ğŸ§  Ù…Ø¹Ø§Ù„Ø¬Ø© ÙƒÙ„ ØµÙ Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            for (const rawId of allRows)
            {
                const state = await dbNoUp_PandBill.keyGet(rawId.key, "PandBillStat");
                const percent = await dbNoUp_PandBill.keyGet(rawId.key, "PandBillPercent");
                const price = await dbNoUp_PandBill.keyGet(rawId.key, "PandBillPrice");
                const PandBillKindWork = await dbNoUp_PandBill.keyGet(rawId.key, "PandBillKindWork");
                const PandBillKindSum = await dbNoUp_PandBill.keyGet(rawId.key, "PandBillKindSum");

                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø© Ø¥Ø°Ø§ ÙƒØ§Ù†Øª ØºÙŠØ± Ù…Ø·Ø§Ø¨Ù‚Ø© Ù„Ù„Ù†Øµ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹
                if (state == null || state === "" || state !== statPrevText)
                {
                    await dbNoUp_PandBill.keySet(rawId.key, "PandBillStat", getLang(685));
                }

                // ØªØ¹ÙŠÙŠÙ† Ù†Ø³Ø¨Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ø¥Ø°Ø§ ÙƒØ§Ù†Øª ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©
                if (percent == null || percent === "")
                {
                    await dbNoUp_PandBill.keySet(rawId.key, "PandBillPercent", "100");
                }

                // ØªØ¹ÙŠÙŠÙ† Ù†Ø³Ø¨Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ø¥Ø°Ø§ ÙƒØ§Ù†Øª ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©
                if (price == null || price === "")
                {
                    await dbNoUp_PandBill.keySet(
                        rawId.key,
                        "PandBillPrice",
                        pandPrice
                    );
                }

                if (PandBillKindWork == null || PandBillKindWork === "")
                {
                    await isPriceEdit(rawId.key, 0);
                    await dbNoUp_PandBill.keySet(
                        rawId.key,
                        "PandBillKindWork",
                        "0"
                    );

                }
                else
                {
                    if (PandBillKindWork == "0")
                    {
                        await isPriceEdit(rawId.key, 0);
                    } else
                    {
                        await isPriceEdit(rawId.key, 1);
                    }
                }

                if (PandBillKindSum == null || PandBillKindSum === "")
                {
                    await dbNoUp_PandBill.keySet(
                        rawId.key,
                        "PandBillKindSum",
                        "0"
                    );
                }

            }
            // #endregion

            // #region ğŸ–¼ï¸ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚ÙŠÙ… Ø¯Ø§Ø®Ù„ Ø¹Ù†Ø§ØµØ± Ø§Ù„ØµÙØ­Ø©

            const priceWorks = document.querySelectorAll('[id="priceWork"]');
            const states = document.querySelectorAll('[id="PandBillStat"]');
            const percents = document.querySelectorAll('[id="PandBillPercent"]');
            const prices = document.querySelectorAll('[id="PandBillPrice"]');
            const PandBillKindWorks = document.querySelectorAll('[id="PandBillKindWork"]');
            const PandBillKindSums = document.querySelectorAll('[id="PandBillKindSum"]');

            priceWorks.forEach((priceWork) =>
            {
                priceWork.innerText = pandPrice;
            });

            states.forEach((state) =>
            {
                if (
                    state.value == null ||
                    state.value === "" ||
                    state.value !== statPrevText
                )
                {
                    state.value = getLang(685);
                }
            });

            percents.forEach((percent) =>
            {
                if (percent.value == null || percent.value === "")
                {
                    percent.value = "100";
                }
            });

            prices.forEach((price) =>
            {
                if (price.value == null || price.value === "")
                {
                    price.value = pandPrice;
                }
            });

            PandBillKindWorks.forEach((PandBillKindWork) =>
            {
                if (PandBillKindWork.value == null || PandBillKindWork.value === "")
                {
                    PandBillKindWork.value = "0";
                }
            });

            PandBillKindSums.forEach((PandBillKindSum) =>
            {
                if (PandBillKindSum.value == null || PandBillKindSum.value === "")
                {
                    PandBillKindSum.value = "0";
                }
            });

            await restoreAllInputsFromIndexDB("results", dbNoUp_PandBill, 'resultsTable');
            await watchingAllInputs2IndexDB("results", dbNoUp_PandBill, 'resultsTable');

            // #endregion

        } catch (error)
        {
            // #region âŒ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø£Ø®Ø·Ø§Ø¡
            console.error("ğŸš¨ Error in initialValues:", error);
            // #endregion
        } finally
        {
            // #region âœ… Ø¥Ø¹Ø§Ø¯Ø© ØªÙØ¹ÙŠÙ„ Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø¬Ø¯ÙˆÙ„
            isTableWatcherEnabled = true;
            // #endregion
        }

    }
    async function isPriceEdit(tableId, state)
    {
        q('raw_99999999999 ' + tableId + ' -<>- ' + state);

        let rawElement = document.getElementById(tableId + "_");

        if (rawElement)
        {

            let priceElement = rawElement.querySelector("#PandBillPrice");

            if (priceElement)
            {
                if (state == 1 || state == "1")
                {
                    priceElement.removeAttribute("readonly");
                    priceElement.style.border = "1px solid #234890"; // Ù„Ø¥Ø¸Ù‡Ø§Ø± Ø£Ù† Ø§Ù„Ø­Ù‚Ù„ Ù‚Ø§Ø¨Ù„ Ù„Ù„ØªØ¹Ø¯ÙŠÙ„
                    priceElement.style.backgroundColor = "#234890";
                }
                else
                {
                    priceElement.setAttribute("readonly", true);
                    priceElement.style.border = "none"; // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø´ÙƒÙ„ Ø§Ù„Ø³Ø§Ø¨Ù‚
                    priceElement.style.backgroundColor = "transparent";
                }
            }
            
        }

    }

</script>